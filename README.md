# StatRumble

StatRumble is a data debate MVP where users upload a metric series, discuss selected ranges in threads, and get a Referee decision generated by Codex.

## What
- Upload CSV metric data
- Visualize trend data with charts
- Discuss selected segments in Arena threads
- Use OpenAI Responses API as Referee for decisions

## Stack
- Next.js (App Router) + TypeScript + Tailwind + ESLint
- Supabase (`@supabase/supabase-js`, `@supabase/ssr`)
- Recharts
- PapaParse
- OpenAI SDK
- Zod

## Project Structure
- App code: `statrumble/`
- Verification script: `scripts/verify.sh`
- Development log: `docs/CODEX_LOG.md`
- Agent rules: `AGENTS.md`

## Run Locally
1. Install dependencies:
```bash
cd statrumble
npm install
```
2. Configure env:
```bash
cp ../.env.example .env.local
```
   - local env file path: `statrumble/.env.local`
   - Referee 사용을 위해 `OPENAI_API_KEY`가 필요합니다.
   - (선택) `OPENAI_REFEREE_MODEL`로 Referee 모델을 변경할 수 있습니다. 기본값은 `gpt-5-mini`입니다.
   - 일부 모델은 `temperature` 같은 샘플링 파라미터를 지원하지 않을 수 있습니다.
3. Start dev server:
```bash
npm run dev
```
4. Optional checks from repository root:
```bash
npm run lint
npm run typecheck
npm run verify
```

## Apply Migration
1. Supabase Dashboard -> SQL Editor에서 `statrumble/supabase/migrations/000_init.sql` 내용을 실행합니다.
2. (권장) Supabase CLI를 쓰는 경우 repo root에서 `npx -y supabase db push`를 실행해 최신 migration을 모두 반영합니다.
3. (선택) CLI 기본 migration 경로는 `statrumble/supabase/migrations` 입니다.
4. `create_workspace`, `join_workspace_by_code` 같은 onboarding RPC도 migration 적용 후에만 동작합니다.
5. 기본 워크스페이스 UUID는 `11111111-1111-1111-1111-111111111111` 입니다.

## Supabase Auth (OTP Email)
1. Supabase Dashboard -> Authentication -> Providers -> Email에서 Email OTP(Magic Link)를 활성화합니다.
2. Authentication -> URL Configuration에서 Site URL을 `http://localhost:3000`으로 설정합니다.
3. Redirect URLs에 `http://localhost:3000/auth/callback`을 추가합니다.
4. Supabase URL/Anon Key는 `statrumble/.env.local`에 설정합니다.

## Notes
- Codex is used as the Referee model via the OpenAI Responses API.
- Development process and prompt-by-prompt outcomes are logged in `docs/CODEX_LOG.md`.
- No API keys in repository. Use local environment variables only.
- `arena_threads.visibility` exists for future public/invite flows, but current RLS behavior remains workspace-private.
- Public thread exposure will require separate public-data policies for imports/snapshots before enabling `visibility='public'`.
